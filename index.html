<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Juego Interactivo de Personajes B√≠blicos para Ni√±os</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap');
  body {
    font-family: 'Poppins', sans-serif;
    margin: 0; padding: 20px;
    background: #f0f9ff;
    display: flex;
    justify-content: center;
    min-height: 100vh;
    color: #333;
  }
  #game-container {
    max-width: 480px;
    width: 100%;
    background: white;
    border-radius: 12px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    padding: 24px;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
  }
  h1, h2 {
    text-align: center;
    margin-bottom: 20px;
    font-weight: 700;
    color: #2a4568;
  }
  input[type=text], button {
    width: 100%;
    font-size: 1.1rem;
    padding: 12px 16px;
    margin-bottom: 18px;
    border-radius: 8px;
    border: 2px solid #3178c6;
    outline: none;
    transition: border-color 0.3s ease;
    box-sizing: border-box;
    user-select: none;
  }
  input[type=text]:focus {
    border-color: #ffbb33;
  }
  button {
    background-color: #3178c6;
    color: white;
    font-weight: 700;
    border: none;
    cursor: pointer;
  }
  button:hover, button:focus {
    background-color: #245a8b;
    outline: none;
  }
  button.bounce {
    animation: bounce 0.7s infinite alternate;
  }
  @keyframes bounce {
    0% { transform: translateY(0); }
    100% { transform: translateY(-8px); }
  }
  #start-screen, #quiz-screen {
    width: 100%;
  }
  #quiz-screen {
    display: none;
  }
  .question {
    font-size: 1.3rem;
    font-weight: 700;
    margin-bottom: 22px;
  }
  .options {
    display: flex;
    flex-direction: column;
    gap: 14px;
    margin-bottom: 20px;
  }
  .option-btn {
    background: #d0e4ff;
    border: 2px solid #3178c6;
    border-radius: 10px;
    padding: 14px;
    font-size: 1.1rem;
    font-weight: 600;
    transition: background-color 0.3s ease, border-color 0.3s ease;
    cursor: pointer;
    user-select: none;
  }
  .option-btn:hover, .option-btn:focus {
    background-color: #ffe599;
    border-color: #d1a700;
    outline: none;
  }
  .option-btn.correct {
    background-color: #a1d99b;
    border-color: #3a7a0b;
    color: #21550d;
    cursor: default;
  }
  .option-btn.wrong {
    background-color: #f9a69a;
    border-color: #a8312a;
    color: #611e19;
    cursor: default;
  }
  #progress-bar {
    width: 100%;
    height: 30px;
    background: linear-gradient(90deg, #cee1ff, #91b7ff);
    border-radius: 15px;
    overflow: hidden;
    margin-bottom: 24px;
    display: flex;
    align-items: center;
  }
  #progress-inner {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #3178c6, #ffbb33);
    color: white;
    font-weight: 700;
    text-align: right;
    padding-right: 14px;
    border-radius: 15px 0 0 15px;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 6px;
    white-space: nowrap;
    font-size: 1.1rem;
  }
  #levels-display {
    margin-top: 20px;
    background: #dff0fd;
    border-radius: 8px;
    padding: 18px 16px;
    max-height: 220px;
    overflow-y: auto;
    display: none;
  }
  #levels-display h3 {
    margin-top: 0;
    margin-bottom: 14px;
    color: #0e3d91;
  }
  .level-item {
    background: #b6d1ff;
    border-radius: 8px;
    padding: 8px 12px;
    margin-bottom: 10px;
    font-weight: 600;
    display: flex;
    justify-content: space-between;
    gap: 10px;
    align-items: center;
    color: #143eae;
  }
  .level-item.unlocked {
    background: #82bf56;
    color: white;
  }
  .emoji {
    display: inline-block;
    width: 25px;
    height: 25px;
    user-select: none;
    animation: emoji-bounce 1.5s ease-in-out infinite alternate;
  }
  @keyframes emoji-bounce {
    0% { transform: translateY(0) scale(1); }
    100% { transform: translateY(-6px) scale(1.2); }
  }
  .message-biblical {
    font-style: italic;
    font-weight: 600;
    color: #ffbb33;
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 18px;
    font-size: 1.1rem;
  }
  .message-biblical svg {
    width: 22px;
    height: 22px;
    user-select: none;
    animation: emoji-bounce 1.5s ease-in-out infinite alternate;
  }
  @media (max-width: 480px) {
    body { padding: 16px 10px;}
    #game-container {
      padding: 20px 18px;
    }
    h1, h2 {
      font-size: 1.4rem;
    }
    .question {
      font-size: 1.1rem;
    }
    button, input[type=text], .option-btn {
      font-size: 1rem;
      padding: 12px;
    }
    #progress-inner {
      font-size: 1rem;
      padding-right: 10px;
    }
  }
</style>
</head>
<body>
<div id="game-container" role="main" aria-live="polite" aria-atomic="true">

  <section id="start-screen" aria-label="Pantalla de inicio">
    <h1>Juego Interactivo de Personajes B√≠blicos para Ni√±os</h1>
    <label for="player-name" class="sr-only">Escribe tu nombre</label>
    <input id="player-name" type="text" aria-required="true" aria-label="Nombre del jugador" placeholder="Escribe tu nombre aqu√≠" autocomplete="off" />
    <button id="start-btn" class="bounce" aria-label="Bot√≥n para comenzar el juego">Comenzar üôå</button>
    <div class="message-biblical" id="welcome-msg-initial">
      <svg viewBox="0 0 24 24" fill="none" stroke="#ffbb33" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" >
        <circle cx="12" cy="12" r="10" />
        <path d="M8 14s1.5 2 4 2 4-2 4-2" />
        <line x1="9" y1="9" x2="9.01" y2="9" />
        <line x1="15" y1="9" x2="15.01" y2="9" />
      </svg>
      ¬°Dios te ama y est√° feliz de que quieras aprender sobre Sus historias! üìñ‚ú®
    </div>
  </section>

  <section id="quiz-screen" aria-label="Cuestionario de personajes b√≠blicos" tabindex="-1" hidden>
    <h2 id="welcome-msg" aria-live="polite"></h2>
    <div class="question" id="question-text" aria-live="assertive" aria-atomic="true"></div>
    <div class="options" id="options-container" role="list" aria-label="Opciones de respuesta"></div>

    <div class="message-biblical" id="biblical-msg" aria-live="polite"></div>
    <button id="help-btn" aria-label="Mostrar pista para la pregunta" title="Mostrar pista para la pregunta">Ayuda üí°</button>
    <button id="next-btn" aria-label="Pasar a la siguiente pregunta" disabled>Siguiente ‚û°Ô∏è</button>
    <button id="levels-btn" aria-label="Mostrar niveles desbloqueados">Ver niveles üìä</button>

    <div id="progress-bar" aria-label="Barra de progreso">
      <div id="progress-inner" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"></div>
    </div>

    <div id="levels-display" aria-label="Niveles desbloqueados" hidden>
      <h3>Niveles y progreso</h3>
      <div id="levels-list"></div>
    </div>
  </section>

</div>

<audio id="sound-correct" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" preload="auto"></audio>
<audio id="sound-wrong" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" preload="auto"></audio>
<audio id="sound-help" src="https://actions.google.com/sounds/v1/cartoon/slide_whistle_to_drum_hit.ogg" preload="auto"></audio>
<audio id="sound-celebrate" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>

<script>
(() => {
  const startScreen = document.getElementById('start-screen');
  const quizScreen = document.getElementById('quiz-screen');
  const playerNameInput = document.getElementById('player-name');
  const startBtn = document.getElementById('start-btn');
  const welcomeMsgInitial = document.getElementById('welcome-msg-initial');
  const welcomeMsg = document.getElementById('welcome-msg');
  const questionText = document.getElementById('question-text');
  const optionsContainer = document.getElementById('options-container');
  const biblicalMsg = document.getElementById('biblical-msg');
  const helpBtn = document.getElementById('help-btn');
  const nextBtn = document.getElementById('next-btn');
  const levelsBtn = document.getElementById('levels-btn');
  const progressInner = document.getElementById('progress-inner');
  const levelsDisplay = document.getElementById('levels-display');
  const levelsList = document.getElementById('levels-list');
  const feedbackMsg = document.getElementById('feedback-msg');

  const sounds = {
    correct: document.getElementById('sound-correct'),
    wrong: document.getElementById('sound-wrong'),
    help: document.getElementById('sound-help'),
    celebrate: document.getElementById('sound-celebrate'),
  };

  const biblicalMotivation = [
    {text:"¬°Sigue as√≠! üìñ Dios te gu√≠a en cada paso. Salmos 32:8", emoji:"üìñ"},
    {text:"¬°Muy bien! üåü Recuerda que con Dios todo es posible. Mateo 19:26", emoji:"üåü"},
    {text:"¬°Dios est√° contigo siempre! üôè Isa√≠as 41:10", emoji:"üôè"},
    {text:"¬°Aprender de la Biblia es una bendici√≥n! üìö Proverbios 2:6", emoji:"üìö"},
    {text:"¬°Conf√≠a en Dios y avanza! üö∂‚Äç‚ôÇÔ∏è Josu√© 1:9", emoji:"üö∂‚Äç‚ôÇÔ∏è"}
  ];

  const questions = [
    {
      question:"¬øQui√©n derrot√≥ a Goliat con una piedra y una honda?",
      options:["David","Mois√©s","Abraham","El√≠as"],
      correctIndex:0,
      reference:"1 Samuel 17",
      emoji:"ü™®"
    },
    {
      question:"¬øQui√©n construy√≥ un arca para salvar a su familia y animales?",
      options:["No√©","Jon√°s","Jos√©","Isa√≠as"],
      correctIndex:0,
      reference:"G√©nesis 6-9",
      emoji:"üõ∂"
    },
    {
      question:"¬øQui√©n recibi√≥ los Diez Mandamientos en el Monte Sina√≠?",
      options:["Mois√©s","David","Sa√∫l","El√≠as"],
      correctIndex:0,
      reference:"√âxodo 19-20",
      emoji:"üìú"
    },
    {
      question:"¬øQui√©n fue el profeta que desafi√≥ a los profetas de Baal en el Monte Carmelo?",
      options:["El√≠as","Isa√≠as","Jerem√≠as","Samuel"],
      correctIndex:0,
      reference:"1 Reyes 18",
      emoji:"üî•"
    },
    {
      question:"¬øQu√© mujer se convirti√≥ en reina y salv√≥ a su pueblo en Persia?",
      options:["Ester","D√©bora","Mar√≠a","Ruth"],
      correctIndex:0,
      reference:"Ester 2-8",
      emoji:"üëë"
    }
  ];

  let playerName = "";
  let currentQuestion = 0;
  let answeredCorrectly = false;
  let progress = []; // array booleano por pregunta

  // Carga progreso y nombre desde localStorage
  function loadProgress() {
    const storedName = localStorage.getItem('biblicoPlayerName');
    const storedProgress = localStorage.getItem('biblicoProgress');
    const storedCurrentQ = localStorage.getItem('biblicoCurrentQuestion');
    if (storedName) playerName = storedName;
    if (storedProgress) progress = JSON.parse(storedProgress);
    if (storedCurrentQ) currentQuestion = Number(storedCurrentQ);
  }

  // Guarda progreso y nombre en localStorage
  function saveProgress() {
    localStorage.setItem('biblicoPlayerName', playerName);
    localStorage.setItem('biblicoProgress', JSON.stringify(progress));
    localStorage.setItem('biblicoCurrentQuestion', currentQuestion.toString());
  }

  // Animar bot√≥n rebote y tocar sonido
  function animateStartButton() {
    startBtn.classList.add('bounce');
    setTimeout(() => {
      startBtn.classList.remove('bounce');
    }, 500);
    sounds.help.play().catch(() => {});
  }

  // Mostrar mensaje motivador aleatorio
  function showBiblicalMotivation() {
    const msg = biblicalMotivation[Math.floor(Math.random()*biblicalMotivation.length)];
    biblicalMsg.textContent = msg.text;
  }

  // Actualiza la barra de progreso
  function updateProgressBar() {
    const total = questions.length;
    const count = progress.filter(v => v).length;
    const percent = Math.round((count/total)*100);
    progressInner.style.width = percent + '%';
    progressInner.textContent = `${percent}% ‚úÖ`;
    progressInner.setAttribute('aria-valuenow', percent);
  }

  // Mostrar pregunta actual
  function renderQuestion() {
    answeredCorrectly = false;
    helpBtn.disabled = false;
    nextBtn.disabled = true;
    biblicalMsg.textContent = "";
    feedbackMsg.textContent = "";
    questionText.textContent = questions[currentQuestion].question + " " + questions[currentQuestion].emoji;
    optionsContainer.innerHTML = "";
    questions[currentQuestion].options.forEach((opt,i) => {
      const btn = document.createElement('button');
      btn.className = 'option-btn';
      btn.textContent = opt;
      btn.type = 'button';
      btn.onclick = () => handleAnswer(i);
      optionsContainer.appendChild(btn);
    });
    updateProgressBar();
    hideLevelsDisplay();
  }

  // Manejar respuesta seleccionada
  function handleAnswer(selectedIndex) {
    if (answeredCorrectly) return;
    const correctIndex = questions[currentQuestion].correctIndex;
    const buttons = [...optionsContainer.children];
    if (selectedIndex === correctIndex) {
      buttons[selectedIndex].classList.add('correct');
      feedbackMsg.textContent = '¬°Correcto! üìñ ¬°Muy bien!';
      feedbackMsg.style.color = '#3178c6';
      progress[currentQuestion] = true;
      playSound(sounds.correct);
      answeredCorrectly = true;
      nextBtn.disabled = false;
      helpBtn.disabled = true;
      confettiAnimation();
      saveProgress();
    } else {
      buttons[selectedIndex].classList.add('wrong');
      feedbackMsg.textContent = `¬°Casi! üôè Recuerda la historia (${questions[currentQuestion].reference}). Intenta de nuevo.`;
      feedbackMsg.style.color = '#d33b3b';
      playSound(sounds.wrong);
      vibrateDevice(300);
      buttons[selectedIndex].disabled = true;
    }
    buttons.forEach(btn => btn.disabled = btn.classList.contains('correct'));
  }

  // Bot√≥n ayuda muestra pista b√≠blica
  function showHelp() {
    if (answeredCorrectly) return;
    const ref = questions[currentQuestion].reference;
    biblicalMsg.textContent = `Pista: Revisa la historia en ${ref} üìñ`;
    playSound(sounds.help);
  }

  // Bot√≥n siguiente pregunta
  function nextQuestion() {
    if(!answeredCorrectly) return;
    currentQuestion++;
    if (currentQuestion >= questions.length) {
      alert(`¬°Felicidades, ${playerName}! Has terminado el juego üéâ`);
      currentQuestion = 0;
      progress = [];
      saveProgress();
      showStartScreen();
      return;
    }
    saveProgress();
    renderQuestion();
  }

  // Mostrar niveles desbloqueados y progreso
  function toggleLevelsDisplay() {
    if(levelsDisplay.hidden) {
      populateLevelsList();
      levelsDisplay.hidden = false;
      levelsBtn.textContent = "Ocultar niveles üìâ";
    } else {
      levelsDisplay.hidden = true;
      levelsBtn.textContent = "Ver niveles üìä";
    }
  }

  // Rellenar lista de niveles
  function populateLevelsList() {
    levelsList.innerHTML = "";
    questions.forEach((q,idx) => {
      const div = document.createElement('div');
      div.className = 'level-item';
      if(progress[idx]) div.classList.add('unlocked');
      div.textContent = `Pregunta ${idx + 1}: ${q.question}`;
      const emojiSpan = document.createElement('span');
      emojiSpan.setAttribute('aria-hidden',true);
      emojiSpan.className = 'emoji';
      emojiSpan.textContent = progress[idx] ? "‚úÖ" : "üîí";
      div.appendChild(emojiSpan);
      levelsList.appendChild(div);
    });
  }

  // Mostrar pantalla de inicio
  function showStartScreen() {
    startScreen.style.display = "block";
    quizScreen.style.display = "none";
    biblicalMsg.textContent = "";
    welcomeMsgInitial.style.display = "flex";
  }

  // Mostrar pantalla de cuestionario
  function showQuizScreen() {
    startScreen.style.display = "none";
    quizScreen.style.display = "flex";
    welcomeMsgInitial.style.display = "none";
    welcomeMsg.textContent = `¬°Hola ${playerName}! üôå Dios te ama y est√° feliz de que quieras aprender sobre Sus historias. ¬°Vamos a divertirnos y aprender juntos! üìñ‚ú®`;
    renderQuestion();
  }

  // Vibrar en dispositivos compatibles
  function vibrateDevice(ms = 200) {
    if(navigator.vibrate) navigator.vibrate(ms);
  }

  // Reproducir sonido
  function playSound(sound) {
    sound.currentTime = 0;
    sound.play().catch(() => {});
  }

  // Confetti animaci√≥n al responder correcto
  function confettiAnimation() {
    const colors = ['#ffbb33','#34c759','#ff3b30','#5856d6','#ff9500'];
    const count = 20;
    for(let i=0; i<count; i++) {
      const confetti = document.createElement('div');
      confetti.className = 'confetti';
      confetti.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
      confetti.style.left = Math.random()*100 + '%';
      confetti.style.animationDelay = (i * 0.1) + 's';
      document.body.appendChild(confetti);
      setTimeout(() => confetti.remove(), 2000);
    }
    playSound(sounds.celebrate);
  }

  // Ocultar niveles
  function hideLevelsDisplay() {
    levelsDisplay.hidden = true;
    levelsBtn.textContent = "Ver niveles üìä";
  }

  // Eventos
  startBtn.addEventListener('click', () => {
    const name = playerNameInput.value.trim();
    if(!name) {
      alert("Por favor escribe tu nombre");
      playerNameInput.focus();
      return;
    }
    playerName = name;
    loadProgress();
    showQuizScreen();
  });
  helpBtn.addEventListener('click', () => {
    showHelp();
  });
  nextBtn.addEventListener('click', () => {
    nextQuestion();
  });
  levelsBtn.addEventListener('click', () => {
    toggleLevelsDisplay();
  });

  loadProgress();
  if(playerName) {
    showQuizScreen();
  } else {
    showStartScreen();
  }
})();

// Estilos y animaci√≥n para confetti - generados por JS
const styleSheet = document.createElement('style');
styleSheet.type = 'text/css';
styleSheet.innerText = `
.confetti {
  position: fixed;
  top: 0;
  width: 10px;
  height: 10px;
  border-radius: 3px;
  opacity: 0.9;
  animation: fall 1.5s linear forwards;
  z-index: 10000;
}
@keyframes fall {
  0% {transform: translateY(0) rotate(0deg);}
  100% {transform: translateY(90vh) rotate(360deg);}
}`;
document.head.appendChild(styleSheet);
</script>
</body>
</html>
