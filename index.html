<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Juego Interactivo de Personajes B√≠blicos para Ni√±os</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap');
  :root {
    --color-bg: #f0f9ff;
    --color-primary: #3178c6;
    --color-secondary: #ffb600;
    --color-correct: #4caf50;
    --color-wrong: #e53935;
    --color-text: #333;
    --color-button: #4a90e2;
    --color-button-hover: #357abd;
  }
  * {
    box-sizing: border-box;
  }
  body {
    font-family: 'Poppins', sans-serif;
    background-color: var(--color-bg);
    margin: 0;
    padding: 10px;
    color: var(--color-text);
    display: flex;
    justify-content: center;
    min-height: 100vh;
  }
  #game-container {
    max-width: 480px;
    width: 100%;
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 6px 14px rgba(0,0,0,0.1);
    padding: 20px 24px 32px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  h1, h2 {
    text-align: center;
    margin-bottom: 12px;
  }
  input[type="text"] {
    width: 100%;
    padding: 12px;
    font-size: 1.1rem;
    border: 2px solid var(--color-primary);
    border-radius: 6px;
    outline: none;
    transition: border-color 0.3s ease;
  }
  input[type="text"]:focus {
    border-color: var(--color-secondary);
  }
  button {
    cursor: pointer;
    background-color: var(--color-button);
    color: white;
    border: none;
    padding: 12px 24px;
    margin-top: 16px;
    font-size: 1rem;
    font-weight: 700;
    border-radius: 6px;
    box-shadow: 0 4px 8px rgba(70,130,180,0.4);
    transition: background-color 0.3s ease, transform 0.3s ease;
    user-select: none;
  }
  button:hover, button:focus {
    background-color: var(--color-button-hover);
    outline: none;
  }
  button.bounce {
    animation: bounce 0.7s infinite alternate;
  }
  @keyframes bounce {
    0% { transform: translateY(0); }
    100% { transform: translateY(-8px); }
  }
  .question-box {
    margin-top: 24px;
    width: 100%;
  }
  .question-text {
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 18px;
    display: flex;
    align-items: center;
  }
  .emoji-sm {
    width: 28px;
    height: 28px;
    margin-left: 8px;
  }
  .options {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .option-button {
    background-color: #e3f2fd;
    border: 2px solid var(--color-primary);
    border-radius: 6px;
    padding: 10px;
    font-size: 1.1rem;
    font-weight: 600;
    text-align: center;
    transition: background-color 0.3s ease, border-color 0.3s ease;
  }
  .option-button:hover, .option-button:focus {
    background-color: var(--color-secondary);
    border-color: #e67e22;
    outline: none;
  }
  .option-button.correct {
    border-color: var(--color-correct);
    background-color: #d0f0d6;
  }
  .option-button.wrong {
    border-color: var(--color-wrong);
    background-color: #f9d6d5;
  }
  .message-box {
    margin-top: 16px;
    font-size: 1rem;
    font-weight: 500;
    color: var(--color-primary);
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .message-biblical {
    font-style: italic;
    font-weight: 600;
    color: var(--color-secondary);
  }
  #help-btn, #next-btn, #levels-btn {
    margin-top: 14px;
  }
  #progress-bar {
    width: 100%;
    height: 28px;
    border-radius: 14px;
    overflow: hidden;
    margin-top: 24px;
    background-color: #cbe0f8;
    display: flex;
    align-items: center;
  }
  #progress-inner {
    height: 100%;
    width: 0;
    background: linear-gradient(90deg, #46a9ff, #82caff);
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding-right: 10px;
    color: white;
    font-weight: 700;
    font-size: 1.1rem;
    border-radius: 14px 0 0 14px;
    animation: progressColor 3s ease infinite alternate;
  }
  @keyframes progressColor {
    0% { background: linear-gradient(90deg, #46a9ff, #82caff); }
    100% { background: linear-gradient(90deg, #ffbb33, #ffdd66); }
  }
  .confetti-piece {
    position: absolute;
    width: 8px;
    height: 8px;
    background-color: var(--color-secondary);
    opacity: 0;
    border-radius: 2px;
    animation: confetti-fall 1.2s ease forwards;
  }
  @keyframes confetti-fall {
    0% { opacity: 1; transform: translateY(0) rotate(0deg); }
    100% { opacity: 0; transform: translateY(100px) rotate(360deg); }
  }
  #levels-display {
    margin-top: 24px;
    width: 100%;
    background: #eaf3ff;
    padding: 16px 12px;
    border-radius: 10px;
    max-height: 220px;
    overflow-y: auto;
    font-size: 1rem;
  }
  #levels-display h3 {
    margin-top: 0;
  }
  .level-item {
    padding: 6px 8px;
    border-radius: 6px;
    margin-bottom: 6px;
    background-color: #d6e8ff;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .level-item.unlocked {
    background-color: #a5d6ff;
    font-weight: 600;
  }
  .level-emoji {
    font-size: 1.2rem;
  }
  /* Animaci√≥n emojis */
  .emoji-animate {
    animation: emoji-balance 1.5s ease infinite alternate;
  }
  @keyframes emoji-balance {
    0% { transform: translateY(0) rotate(0deg); }
    100% { transform: translateY(-6px) rotate(10deg); }
  }
  /* Responsive text scaling */
  @media screen and (max-width: 400px) {
    .question-text {
      font-size: 1.1rem;
    }
    button {
      font-size: 0.95rem;
      padding: 10px 18px;
    }
  }
</style>
</head>
<body>
<div id="game-container" role="main" aria-live="polite" aria-atomic="true">

  <!-- Pantalla Inicio -->
  <section id="start-screen" aria-label="Inicio del juego">
    <h1>Juego Interactivo de Personajes B√≠blicos para Ni√±os</h1>
    <label for="player-name" aria-describedby="name-desc">Escribe tu nombre para comenzar:</label>
    <input id="player-name" type="text" autocomplete="off" aria-required="true" aria-describedby="name-desc" placeholder="Tu nombre aqu√≠" />
    <p id="name-desc" class="message-biblical">¬°Dios te ama y est√° feliz de que quieras aprender sobre Sus historias! üìñ‚ú®</p>
    <button id="start-btn" class="bounce" aria-label="Comenzar juego con animaci√≥n y sonido">Comenzar üôå</button>
  </section>

  <!-- Pantalla Juego -->
  <section id="quiz-screen" aria-label="Cuestionario de personajes b√≠blicos" hidden>
    <h2 id="welcome-msg"></h2>
    <div class="question-box" aria-live="assertive" aria-atomic="true">
      <div class="question-text" id="question-text"></div>
      <div class="options" role="list" id="options-container"></div>
    </div>
    <div class="message-box" id="feedback-msg" aria-live="assertive"></div>
    <button id="help-btn" aria-label="Ayuda para la pregunta actual">Ayuda üí°</button>
    <button id="next-btn" aria-label="Siguiente pregunta" disabled>Avanzar ‚û°Ô∏è</button>
    <button id="levels-btn" aria-label="Ver niveles desbloqueados">Ver niveles üìä</button>

    <div id="progress-bar" aria-label="Barra de progreso del juego">
      <div id="progress-inner" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"></div>
    </div>

    <div id="levels-display" aria-label="Niveles desbloqueados" hidden>
      <h3>Progreso y Niveles</h3>
      <div id="levels-list"></div>
    </div>
  </section>

</div>

<!-- Sonidos -->
<audio id="sound-correct" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" preload="auto"></audio>
<audio id="sound-wrong" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" preload="auto"></audio>
<audio id="sound-bounce" src="https://actions.google.com/sounds/v1/cartoon/pop.ogg" preload="auto"></audio>
<audio id="sound-help" src="https://actions.google.com/sounds/v1/cartoon/slide_whistle_to_drum_hit.ogg" preload="auto"></audio>
<audio id="sound-celebrate" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>

<script>
(() => {
  'use strict';

  const gameData = {
    biblicalMessages: [
      {text: "¬°Sigue as√≠! üìñ Dios te gu√≠a en cada paso. Salmos 32:8", emoji: "üìñ"},
      {text: "¬°Muy bien! üåü Recuerda que con Dios todo es posible. Mateo 19:26", emoji: "üåü"},
      {text: "¬°Dios est√° contigo siempre! üôè Isa√≠as 41:10", emoji: "üôè"},
      {text: "¬°Aprender de la Biblia es una bendici√≥n! üìö Proverbios 2:6", emoji: "üìö"},
      {text: "¬°Conf√≠a en Dios y avanza! üö∂‚Äç‚ôÇÔ∏è Josu√© 1:9", emoji: "üö∂‚Äç‚ôÇÔ∏è"}
    ],
    questions: [
      {
        question: "¬øQui√©n derrot√≥ a Goliat con una piedra y una honda?",
        options: ["David", "Mois√©s", "Abraham", "El√≠as"],
        correct: 0,
        reference: "1 Samuel 17",
        emoji: "ü™®"
      },
      {
        question: "¬øQui√©n fue conocido por construir un arca para salvar a su familia y animales del diluvio?",
        options: ["No√©", "Jon√°s", "Jos√©", "Isa√≠as"],
        correct: 0,
        reference: "G√©nesis 6-9",
        emoji: "üõ∂"
      },
      {
        question: "¬øQui√©n recibi√≥ los Diez Mandamientos en el Monte Sina√≠?",
        options: ["Mois√©s", "David", "Sa√∫l", "El√≠as"],
        correct: 0,
        reference: "√âxodo 19-20",
        emoji: "üìú"
      },
      {
        question: "¬øQui√©n fue el profeta que desafi√≥ a los profetas de Baal en el monte Carmelo?",
        options: ["El√≠as", "Isa√≠as", "Jerem√≠as", "Samuel"],
        correct: 0,
        reference: "1 Reyes 18",
        emoji: "üî•"
      },
      {
        question: "¬øQu√© mujer se convirti√≥ en reina y salv√≥ a su pueblo en Persia?",
        options: ["Ester", "D√©bora", "Mar√≠a", "Ruth"],
        correct: 0,
        reference: "Ester 2-8",
        emoji: "üëë"
      }
    ]
  };

  // Dom elements
  const startScreen = document.getElementById('start-screen');
  const quizScreen = document.getElementById('quiz-screen');
  const playerNameInput = document.getElementById('player-name');
  const startBtn = document.getElementById('start-btn');
  const welcomeMsg = document.getElementById('welcome-msg');
  const questionText = document.getElementById('question-text');
  const optionsContainer = document.getElementById('options-container');
  const feedbackMsg = document.getElementById('feedback-msg');
  const helpBtn = document.getElementById('help-btn');
  const nextBtn = document.getElementById('next-btn');
  const levelsBtn = document.getElementById('levels-btn');
  const progressInner = document.getElementById('progress-inner');
  const levelsDisplay = document.getElementById('levels-display');
  const levelsList = document.getElementById('levels-list');

  const soundCorrect = document.getElementById('sound-correct');
  const soundWrong = document.getElementById('sound-wrong');
  const soundBounce = document.getElementById('sound-bounce');
  const soundHelp = document.getElementById('sound-help');
  const soundCelebrate = document.getElementById('sound-celebrate');

  let playerName = '';
  let currentQuestionIndex = 0;
  let answeredCorrectly = false;
  let progress = [];
  let ignoreClicks = false;

  // Utilidades
  function createEmojiSpan(emoji, title = '') {
    const span = document.createElement('span');
    span.textContent = emoji;
    span.setAttribute('role', 'img');
    if (title) span.setAttribute('aria-label', title);
    span.classList.add('emoji-sm', 'emoji-animate');
    return span;
  }

  function vibrateDevice(duration = 200) {
    if (navigator.vibrate) navigator.vibrate(duration);
  }

  function playSound(soundEl) {
    if (!soundEl) return;
    soundEl.currentTime = 0;
    soundEl.play().catch(() => {});
  }

  // Guardar y cargar progreso local
  function loadProgress() {
    const saved = localStorage.getItem('biblicalGameProgress');
    if (saved) {
      try {
        const data = JSON.parse(saved);
        if (data.playerName) {
          playerName = data.playerName;
          currentQuestionIndex = data.currentQuestionIndex || 0;
          progress = data.progress || [];
        }
      } catch {}
    }
  }
  function saveProgress() {
    localStorage.setItem('biblicalGameProgress', JSON.stringify({
      playerName,
      currentQuestionIndex,
      progress
    }));
  }

  // Mensaje de bienvenida motivador
  function showWelcomeMessage() {
    welcomeMsg.innerHTML = `¬°Hola <strong>${playerName}</strong>! üôå Dios te ama y est√° feliz de que quieras aprender sobre Sus historias. ¬°Vamos a divertirnos y aprender juntos! üìñ‚ú®`;
  }

  // Renderizar la pregunta actual
  function renderQuestion() {
    ignoreClicks = false;
    answeredCorrectly = false;
    feedbackMsg.textContent = '';
    nextBtn.disabled = true;
    helpBtn.disabled = false;
    const q = gameData.questions[currentQuestionIndex];
    questionText.innerHTML = `${q.question} ${createEmojiSpan(q.emoji).outerHTML}`;
    optionsContainer.innerHTML = '';
    q.options.forEach((opt, i) => {
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.textContent = opt;
      btn.className = 'option-button';
      btn.setAttribute('data-index', i);
      btn.setAttribute('role', 'listitem');
      btn.addEventListener('click', handleAnswer);
      optionsContainer.appendChild(btn);
    });

    updateProgressBar();
    hideLevelsDisplay();
  }

  // Manejar respuesta de opci√≥n
  function handleAnswer(evt) {
    if (ignoreClicks) return;
    const chosenIndex = +evt.currentTarget.getAttribute('data-index');
    const correctIndex = gameData.questions[currentQuestionIndex].correct;
    if (chosenIndex === correctIndex) {
      answeredCorrectly = true;
      markOptionCorrect(chosenIndex);
      showFeedbackCorrect();
      playSound(soundCorrect);
      playConfetti();
      nextBtn.disabled = false;
      helpBtn.disabled = true;
      progress[currentQuestionIndex] = true;
      saveProgress();
    } else {
      playSound(soundWrong);
      vibrateDevice(300);
      markOptionWrong(chosenIndex);
      showFeedbackIncorrect();
    }
  }

  // Marcar opci√≥n correcta y deshabilitar opciones
  function markOptionCorrect(correctIdx) {
    [...optionsContainer.children].forEach((btn, i) => {
      btn.disabled = true;
      if (i === correctIdx) btn.classList.add('correct');
    });
    ignoreClicks = true;
  }

  // Marcar opci√≥n incorrecta (permite volver a intentar)
  function markOptionWrong(wrongIdx) {
    const btn = optionsContainer.children[wrongIdx];
    btn.classList.add('wrong');
    btn.disabled = true;
  }

  // Mensaje motivador correcto
  function showFeedbackCorrect() {
    const msg = gameData.biblicalMessages[Math.floor(Math.random()*gameData.biblicalMessages.length)];
    feedbackMsg.innerHTML = `${msg.text} ${createEmojiSpan(msg.emoji).outerHTML}`;
    feedbackMsg.style.color = 'var(--color-correct)';
  }

  // Mensaje motivador incorrecto con referencia b√≠blica
  function showFeedbackIncorrect() {
    const q = gameData.questions[currentQuestionIndex];
    feedbackMsg.innerHTML = `¬°Casi! üôè Recuerda la historia referida en (${q.reference}). Intenta de nuevo.`;
    feedbackMsg.style.color = 'var(--color-wrong)';
  }

  // Bot√≥n ayuda muestra pista con referencia b√≠blica y anima
  function showHelp() {
    if (answeredCorrectly) return;
    const q = gameData.questions[currentQuestionIndex];
    feedbackMsg.innerHTML = `Pista: Revisa (${q.reference}) para ayudarte.`;
    playSound(soundHelp);
  }

  // Avanzar a siguiente pregunta
  function goToNextQuestion() {
    if (!answeredCorrectly) return;
    currentQuestionIndex++;
    if (currentQuestionIndex >= gameData.questions.length) {
      currentQuestionIndex = 0;
    }
    renderQuestion();
    saveProgress();
  }

  // Mostrar niveles desbloqueados y progreso
  function showLevels() {
    levelsDisplay.hidden = !levelsDisplay.hidden;
    if (!levelsDisplay.hidden) {
      populateLevelsList();
      levelsBtn.textContent = 'Ocultar niveles üìâ';
    } else {
      levelsBtn.textContent = 'Ver niveles üìä';
    }
  }
  function hideLevelsDisplay() {
    levelsDisplay.hidden = true;
    levelsBtn.textContent = 'Ver niveles üìä';
  }
  function populateLevelsList() {
    levelsList.innerHTML = '';
    gameData.questions.forEach((q, idx) => {
      const div = document.createElement('div');
      div.className = "level-item" + (progress[idx] ? " unlocked" : "");
      div.textContent = `Pregunta ${idx+1}: ${q.question} `;
      const emoji = document.createElement('span');
      emoji.className = "level-emoji";
      emoji.textContent = progress[idx] ? "‚úÖ" : "üîí";
      div.appendChild(emoji);
      levelsList.appendChild(div);
    });
  }

  // Barra de progreso visual y emojis
  function updateProgressBar() {
    const total = gameData.questions.length;
    const correctCount = progress.filter(v => v).length;
    const percent = Math.round((correctCount / total) * 100);
    progressInner.style.width = percent + '%';
    progressInner.setAttribute('aria-valuenow', percent);
    progressInner.textContent = `${percent}% üéâ`.repeat(1);

    // Animar colores - ya en CSS con keyframes
  }

  // Confetti simple animado por pocos segundos
  function playConfetti() {
    const count = 15;
    for (let i = 0; i < count; i++) {
      const confetti = document.createElement('div');
      confetti.className = 'confetti-piece';
      confetti.style.left = `${Math.random()*100}%`;
      confetti.style.backgroundColor = `hsl(${Math.random()*360}, 70%, 60%)`;
      confetti.style.top = '0';
      confetti.style.animationDelay = `${i/20}s`;
      confetti.style.position = 'fixed';
      confetti.style.zIndex = '9999';
      document.body.appendChild(confetti);
      setTimeout(() => confetti.remove(), 1200);
    }
    playSound(soundCelebrate);
  }

  // Animar bot√≥n comenzar con sonido al clic
  startBtn.addEventListener('click', () => {
    const name = playerNameInput.value.trim();
    if (!name) {
      alert('Por favor, escribe tu nombre para comenzar.');
      playerNameInput.focus();
      return;
    }
    playerName = name;
    saveProgress();
    startBtn.disabled = true;
    playSound(soundBounce);
    setTimeout(() => {
      startScreen.hidden = true;
      quizScreen.hidden = false;
      showWelcomeMessage();
      renderQuestion();
      startBtn.disabled = false;
    }, 400);
  });

  helpBtn.addEventListener('click', () => {
    showHelp();
  });

  nextBtn.addEventListener('click', () => {
    goToNextQuestion();
  });

  levelsBtn.addEventListener('click', () => {
    showLevels();
  });

  // Al cargar pagina, comprobar progreso guardado
  function initialize() {
    loadProgress();
    if (playerName) {
      startScreen.hidden = true;
      quizScreen.hidden = false;
      playerNameInput.value = playerName;
      showWelcomeMessage();
      renderQuestion();
    }
  }

  initialize();

})();
</script>
</body>
</html>
