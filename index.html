<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Bíblico Infantil</title>
    <style>
        :root {
            --color-primary: #4e7bca;
            --color-secondary: #f9a826;
            --color-success: #2ecc71;
            --color-danger: #e74c3c;
            --color-background: #f8f9fa;
            --color-text: #333;
            --color-text-light: #fff;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --border-radius: 12px;
        }

        .theme-dark {
            --color-primary: #3a5e9c;
            --color-secondary: #e59400;
            --color-background: #2c3e50;
            --color-text: #ecf0f1;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.4);
        }

        .theme-party {
            --color-primary: #e84393;
            --color-secondary: #00cec9;
            --color-background: #fdcb6e;
            --color-text: #2d3436;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.3s, color 0.3s;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background-color: var(--color-background);
            color: var(--color-text);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            color: var(--color-primary);
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        h2 {
            color: var(--color-secondary);
            font-size: 1.8rem;
            margin-bottom: 15px;
        }

        p {
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .screen {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .btn {
            background-color: var(--color-primary);
            color: var(--color-text-light);
            border: none;
            padding: 12px 24px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1.1rem;
            font-family: inherit;
            margin: 10px 5px;
            box-shadow: var(--shadow);
            transition: transform 0.2s, background-color 0.2s;
        }

        .btn:hover {
            transform: translateY(-3px);
            background-color: color-mix(in srgb, var(--color-primary) 90%, black);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background-color: var(--color-secondary);
        }

        .btn-success {
            background-color: var(--color-success);
        }

        .btn-danger {
            background-color: var(--color-danger);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .welcome-message {
            background-color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            text-align: center;
        }

        .input-name {
            width: 100%;
            max-width: 300px;
            padding: 12px;
            border: 2px solid var(--color-primary);
            border-radius: var(--border-radius);
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .question-container {
            background-color: white;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: var(--color-primary);
        }

        .options-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        @media (min-width: 600px) {
            .options-container {
                grid-template-columns: 1fr 1fr;
            }
        }

        .option-btn {
            background-color: #f1f2f6;
            color: var(--color-text);
            border: 2px solid transparent;
            padding: 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            text-align: left;
            transition: all 0.2s;
        }

        .option-btn:hover {
            background-color: #dfe4ea;
        }

        .option-btn.correct {
            background-color: var(--color-success);
            color: white;
        }

        .option-btn.incorrect {
            background-color: var(--color-danger);
            color: white;
        }

        .progress-container {
            margin-bottom: 20px;
        }

        .progress-bar {
            height: 20px;
            background-color: #f1f2f6;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--color-primary);
            width: 0%;
            transition: width 0.5s ease;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
        }

        .hint-container {
            background-color: #ffeaa7;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            display: none;
        }

        .hint-container.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .emoji-container {
            text-align: center;
            margin: 20px 0;
            font-size: 3rem;
        }

        .level-map {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .level-item {
            background-color: white;
            padding: 15px;
            border-radius: var(--border-radius);
            text-align: center;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .level-item:hover {
            transform: scale(1.05);
        }

        .level-item.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .level-stars {
            color: var(--color-secondary);
            font-size: 1.2rem;
            margin-top: 5px;
        }

        .settings-panel {
            background-color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .setting-item {
            margin-bottom: 15px;
        }

        .confetti {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            display: none;
        }

        .confetti.active {
            display: block;
        }

        .celebration {
            text-align: center;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .accessibility-options {
            margin-top: 20px;
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            font-size: 0.9rem;
            color: #7f8c8d;
        }

        .home-button {
            display: inline-block;
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #6c757d;
            color: white;
            text-decoration: none;
            border-radius: var(--border-radius);
            transition: background-color 0.2s;
        }

        .home-button:hover {
            background-color: #5a6268;
            color: white;
        }

        /* Responsive adjustments */
        @media (max-width: 600px) {
            h1 {
                font-size: 2rem;
            }
            
            h2 {
                font-size: 1.5rem;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 1rem;
            }
            
            .question-text {
                font-size: 1.1rem;
            }
            
            .level-map {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Pantalla de bienvenida -->
        <div id="welcome-screen" class="screen active">
            <header>
                <h1>Quiz Bíblico Infantil</h1>
                <div class="emoji-container">📖✨</div>
            </header>
            
            <div class="welcome-message">
                <p id="personalized-message">¡Hola! Dios te ama y está contento de que quieras aprender Sus historias. ¡Vamos a jugar y aprender juntos!</p>
                
                <input type="text" id="player-name" class="input-name" placeholder="Escribe tu nombre" maxlength="20">
                
                <button id="start-btn" class="btn">¡Comenzar! 🎮</button>
            </div>
            
            <div class="settings-panel">
                <h2>Opciones</h2>
                
                <div class="setting-item">
                    <label>
                        <input type="checkbox" id="sound-enabled" checked>
                        Activar sonidos
                    </label>
                </div>
                
                <div class="setting-item">
                    <label>
                        <input type="checkbox" id="animations-enabled" checked>
                        Activar animaciones
                    </label>
                </div>
                
                <div class="setting-item">
                    <label>
                        <input type="checkbox" id="voice-enabled">
                        Leer preguntas en voz alta
                    </label>
                </div>
                
                <div class="setting-item">
                    <label>Tema:</label>
                    <select id="theme-selector">
                        <option value="default">Predeterminado</option>
                        <option value="dark">Nocturno</option>
                        <option value="party">Fiesta</option>
                    </select>
                </div>
                
                <button id="view-levels-btn" class="btn btn-secondary">Ver Niveles</button>
                <button id="reset-progress-btn" class="btn btn-danger">Borrar Progreso</button>
            </div>
            
            <div class="footer">
                <a href="https://www.ipucduitamasancarlos.com.co/p/seccion-kids.html" class="home-button">Volver a la Página Principal</a>
                <p>Diseñado para aprender historias bíblicas de forma divertida</p>
            </div>
        </div>
        
        <!-- Pantalla de selección de niveles -->
        <div id="levels-screen" class="screen">
            <header>
                <h1>Niveles</h1>
                <p>Selecciona un nivel para jugar</p>
            </header>
            
            <div class="level-map" id="level-map-container">
                <!-- Los niveles se generarán dinámicamente con JavaScript -->
            </div>
            
            <div style="text-align: center;">
                <button id="back-from-levels" class="btn">Volver</button>
            </div>
            
            <div class="footer">
                <a href="https://www.ipucduitamasancarlos.com.co/p/seccion-kids.html" class="home-button">Volver a la Página Principal</a>
            </div>
        </div>
        
        <!-- Pantalla de juego -->
        <div id="game-screen" class="screen">
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="level-progress"></div>
                </div>
                <div class="progress-text">
                    <span id="current-level-text">Nivel 1</span>
                    <span id="progress-text">Pregunta 1 de 10</span>
                </div>
            </div>
            
            <div class="question-container">
                <div class="emoji-container" id="question-emoji">❓</div>
                <div class="question-text" id="question-text"></div>
                
                <div class="options-container" id="options-container">
                    <!-- Las opciones se generarán dinámicamente con JavaScript -->
                </div>
                
                <div class="hint-container" id="hint-container">
                    <p><strong>Pista:</strong> <span id="hint-text"></span></p>
                    <p><strong>Referencia bíblica:</strong> <span id="reference-text"></span></p>
                </div>
                
                <div style="text-align: center;">
                    <button id="show-hint-btn" class="btn btn-secondary">Ayuda</button>
                    <button id="next-question-btn" class="btn" disabled>Siguiente</button>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button id="back-to-levels" class="btn btn-secondary">Volver a Niveles</button>
            </div>
            
            <div class="footer">
                <a href="https://www.ipucduitamasancarlos.com.co/p/seccion-kids.html" class="home-button">Volver a la Página Principal</a>
            </div>
        </div>
        
        <!-- Pantalla de resultados -->
        <div id="results-screen" class="screen">
            <header>
                <h1>¡Nivel Completado!</h1>
                <div class="emoji-container celebration">🎉🌟</div>
            </header>
            
            <div class="question-container">
                <h2 id="results-title">¡Felicidades!</h2>
                <p id="results-message">Has completado el nivel con éxito.</p>
                
                <div class="progress-text">
                    <p>Preguntas correctas: <span id="correct-answers">0</span>/10</p>
                    <p>Estrellas obtenidas: <span id="stars-earned">0</span>/3</p>
                </div>
                
                <div style="text-align: center; margin: 25px 0;">
                    <button id="play-again-btn" class="btn">Jugar de nuevo</button>
                    <button id="next-level-btn" class="btn btn-success">Siguiente nivel</button>
                    <button id="back-to-levels-from-results" class="btn btn-secondary">Volver a Niveles</button>
                </div>
            </div>
            
            <div class="footer">
                <a href="https://www.ipucduitamasancarlos.com.co/p/seccion-kids.html" class="home-button">Volver a la Página Principal</a>
            </div>
        </div>
    </div>
    
    <!-- Área de confeti (se muestra con JavaScript) -->
    <div class="confetti" id="confetti"></div>
    
    <!-- Sonidos -->
    <audio id="sound-correct" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" preload="auto"></audio>
    <audio id="sound-wrong" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" preload="auto"></audio>
    <audio id="sound-help" src="https://actions.google.com/sounds/v1/cartoon/slide_whistle_to_drum_hit.ogg" preload="auto"></audio>
    <audio id="sound-celebrate" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>
    <audio id="sound-click" src="https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg" preload="auto"></audio>
    <audio id="sound-applause" src="https://actions.google.com/sounds/v1/crowds/crowd_applause.ogg" preload="auto"></audio>
    
    <script>
        // Variables globales
        let gameData = {
            playerName: '',
            currentLevel: 1,
            currentQuestion: 0,
            score: 0,
            levels: [],
            progress: {}
        };

        // Elementos de audio
        const sounds = {
            correct: document.getElementById('sound-correct'),
            incorrect: document.getElementById('sound-wrong'),
            help: document.getElementById('sound-help'),
            celebrate: document.getElementById('sound-celebrate'),
            click: document.getElementById('sound-click'),
            applause: document.getElementById('sound-applause')
        };

        // Función para reproducir sonido
        function playSound(sound) {
            if (document.getElementById('sound-enabled').checked && sound) {
                sound.currentTime = 0;
                sound.play().catch(e => console.log("Audio error:", e));
            }
        }

        // Cargar preguntas desde JSON
        async function loadQuestions() {
            try {
                // Datos completos con 20 niveles y 200 preguntas
                gameData.levels = [
                    {
                        level: 1,
                        title: "Nivel 1 — Personajes Principiantes",
                        questions: [
                            {
                                id: "1-01",
                                question: "¿Quién derrotó a Goliat con una piedra y una honda?",
                                options: ["David", "Moisés", "Abraham", "Elías"],
                                answerIndex: 0,
                                hint: "Fue un joven pastor que confiaba en Dios.",
                                reference: "1 Samuel 17"
                            },
                            {
                                id: "1-02",
                                question: "¿Quién construyó un arca para salvar a los animales?",
                                options: ["Noé", "Moisés", "Abraham", "David"],
                                answerIndex: 0,
                                hint: "Dios le pidió que construyera un barco muy grande.",
                                reference: "Génesis 6-9"
                            },
                            {
                                id: "1-03",
                                question: "¿Quién fue lanzado al foso de los leones pero Dios lo protegió?",
                                options: ["Daniel", "José", "Jonás", "Elías"],
                                answerIndex: 0,
                                hint: "Oraba a Dios tres veces al día.",
                                reference: "Daniel 6"
                            },
                            {
                                id: "1-04",
                                question: "¿Quién recibió los Diez Mandamientos en el Monte Sinaí?",
                                options: ["Moisés", "Abraham", "Noé", "David"],
                                answerIndex: 0,
                                hint: "Guió al pueblo de Israel fuera de Egipto.",
                                reference: "Éxodo 20"
                            },
                            {
                                id: "1-05",
                                question: "¿Quién fue traicionado por sus hermanos y vendido como esclavo?",
                                options: ["José", "Jacob", "Isaac", "Ismael"],
                                answerIndex: 0,
                                hint: "Tenía una túnica de muchos colores.",
                                reference: "Génesis 37"
                            },
                            {
                                id: "1-06",
                                question: "¿Quién fue el primer hombre que Dios creó?",
                                options: ["Adán", "Noé", "Abraham", "Moisés"],
                                answerIndex: 0,
                                hint: "Dios lo formó del polvo de la tierra.",
                                reference: "Génesis 2"
                            },
                            {
                                id: "1-07",
                                question: "¿Quién fue la primera mujer que Dios creó?",
                                options: ["Eva", "Sara", "Rebeca", "María"],
                                answerIndex: 0,
                                hint: "Dios la formó de la costilla de Adán.",
                                reference: "Génesis 2"
                            },
                            {
                                id: "1-08",
                                question: "¿Quién obedeció a Dios y llevó a su familia a una tierra desconocida?",
                                options: ["Abraham", "Moisés", "Noé", "David"],
                                answerIndex: 0,
                                hint: "Dios le prometió que sería padre de una gran nación.",
                                reference: "Génesis 12"
                            },
                            {
                                id: "1-09",
                                question: "¿Quién fue el hombre más sabio que existió?",
                                options: ["Salomón", "David", "Moisés", "Abraham"],
                                answerIndex: 0,
                                hint: "Era hijo del rey David.",
                                reference: "1 Reyes 3"
                            },
                            {
                                id: "1-10",
                                question: "¿Quién fue alimentado por cuervos en el desierto?",
                                options: ["Elías", "Moisés", "David", "Jonás"],
                                answerIndex: 0,
                                hint: "Fue un profeta que desafió a los sacerdotes de Baal.",
                                reference: "1 Reyes 17"
                            }
                        ]
                    },
                    {
                        level: 2,
                        title: "Nivel 2 — Historias de Fe",
                        questions: [
                            {
                                id: "2-01",
                                question: "¿Quién caminó sobre el agua hacia Jesús?",
                                options: ["Pedro", "Juan", "Andrés", "Felipe"],
                                answerIndex: 0,
                                hint: "Era pescador y uno de los discípulos más cercanos a Jesús.",
                                reference: "Mateo 14:22-33"
                            },
                            {
                                id: "2-02",
                                question: "¿Quién fue llamado por Dios desde una zarza ardiente?",
                                options: ["Moisés", "Abraham", "Isaías", "Jeremías"],
                                answerIndex: 0,
                                hint: "Dios le dijo: 'Quita tus sandalias, porque el lugar que pisas es santo'.",
                                reference: "Éxodo 3"
                            },
                            {
                                id: "2-03",
                                question: "¿Quién interpretó el sueño del faraón sobre las vacas gordas y flacas?",
                                options: ["José", "Daniel", "Salomón", "Samuel"],
                                answerIndex: 0,
                                hint: "Había sido vendido como esclavo a Egipto por sus hermanos.",
                                reference: "Génesis 41"
                            },
                            {
                                id: "2-04",
                                question: "¿Quién fue arrojado a un pozo por sus hermanos?",
                                options: ["José", "David", "Jonás", "Jeremías"],
                                answerIndex: 0,
                                hint: "Sus hermanos estaban celosos porque era el favorito de su padre.",
                                reference: "Génesis 37"
                            },
                            {
                                id: "2-05",
                                question: "¿Quién fue la madre de Samuel?",
                                options: ["Ana", "Sara", "Rebeca", "Raquel"],
                                answerIndex: 0,
                                hint: "Ella oró fervientemente por un hijo y lo dedicó a Dios.",
                                reference: "1 Samuel 1"
                            },
                            {
                                id: "2-06",
                                question: "¿Quién fue el primer mártir de la iglesia cristiana?",
                                options: ["Esteban", "Pedro", "Pablo", "Juan"],
                                answerIndex: 0,
                                hint: "Mientras lo apedreaban, vio los cielos abiertos y a Jesús de pie.",
                                reference: "Hechos 7"
                            },
                            {
                                id: "2-07",
                                question: "¿Quién fue transformado por Jesús de pescador a pescador de hombres?",
                                options: ["Pedro", "Juan", "Andrés", "Santiago"],
                                answerIndex: 0,
                                hint: "Jesús le cambió el nombre de Simón a Pedro.",
                                reference: "Mateo 4:18-20"
                            },
                            {
                                id: "2-08",
                                question: "¿Quién fue el discípulo amado de Jesús?",
                                options: ["Juan", "Pedro", "Santiago", "Mateo"],
                                answerIndex: 0,
                                hint: "Escribió el evangelio que lleva su nombre y el libro de Apocalipsis.",
                                reference: "Juan 13:23"
                            },
                            {
                                id: "2-09",
                                question: "¿Quién fue el hombre más fuerte de la Biblia?",
                                options: ["Sansón", "Goliat", "David", "Saúl"],
                                answerIndex: 0,
                                hint: "Su fuerza estaba en su cabello, que nunca se cortó.",
                                reference: "Jueces 16"
                            },
                            {
                                id: "2-10",
                                question: "¿Quién fue el rey que construyó el primer templo en Jerusalén?",
                                options: ["Salomón", "David", "Saúl", "Ezequías"],
                                answerIndex: 0,
                                hint: "Era hijo del rey David y conocido por su gran sabiduría.",
                                reference: "1 Reyes 6"
                            }
                        ]
                    },
                    {
                        level: 3,
                        title: "Nivel 3 — Milagros de Jesús",
                        questions: [
                            {
                                id: "3-01",
                                question: "¿A cuántas personas alimentó Jesús con cinco panes y dos peces?",
                                options: ["5000", "1000", "7000", "4000"],
                                answerIndex: 0,
                                hint: "Jesús bendijo los panes y los peces, y todos comieron hasta saciarse.",
                                reference: "Juan 6:1-14"
                            },
                            {
                                id: "3-02",
                                question: "¿Qué discípulo negó a Jesús tres veces antes de que cantara el gallo?",
                                options: ["Pedro", "Juan", "Andrés", "Judas"],
                                answerIndex: 0,
                                hint: "Después de negar a Jesús, este discípulo lloró amargamente.",
                                reference: "Mateo 26:69-75"
                            },
                            {
                                id: "3-03",
                                question: "¿Quién fue resucitado por Jesús después de cuatro días de muerto?",
                                options: ["Lázaro", "El hijo de la viuda", "La hija de Jairo", "Dorcas"],
                                answerIndex: 0,
                                hint: "Jesús lloró antes de realizar este milagro.",
                                reference: "Juan 11:1-44"
                            },
                            {
                                id: "3-04",
                                question: "¿Qué hizo Jesús en las bodas de Caná?",
                                options: ["Convirtió agua en vino", "Sanó a un enfermo", "Multiplicó los panes", "Resucitó a un niño"],
                                answerIndex: 0,
                                hint: "Este fue el primer milagro de Jesús.",
                                reference: "Juan 2:1-11"
                            },
                            {
                                id: "3-05",
                                question: "¿Cómo se llamaba el ciego que Jesús sanó en Jericó?",
                                options: ["Bartimeo", "Lázaro", "Simón", "Mateo"],
                                answerIndex: 0,
                                hint: "Este hombre gritaba '¡Jesús, Hijo de David, ten misericordia de mí!'.",
                                reference: "Marcos 10:46-52"
                            },
                            {
                                id: "3-06",
                                question: "¿Qué hizo Jesús cuando calmó la tormenta?",
                                options: ["Reprendió al viento y al mar", "Oró para que cesara la lluvia", "Hizo que apareciera un arcoíris", "Caminó sobre las aguas"],
                                answerIndex: 0,
                                hint: "Jesús estaba durmiendo en la barca cuando comenzó la tormenta.",
                                reference: "Marcos 4:35-41"
                            },
                            {
                                id: "3-07",
                                question: "¿A quién devolvió Jesús la vista haciendo lodo con saliva?",
                                options: ["Un ciego de nacimiento", "Bartimeo", "La suegra de Pedro", "Un paralítico"],
                                answerIndex: 0,
                                hint: "Jesús dijo que este hombre era ciego para que las obras de Dios se manifestaran.",
                                reference: "Juan 9:1-12"
                            },
                            {
                                id: "3-08",
                                question: "¿Cómo se llamaba la mujer que Jesús sanó de flujo de sangre?",
                                options: ["No se menciona su nombre", "María", "Marta", "Salomé"],
                                answerIndex: 0,
                                hint: "Ella tocó el manto de Jesús y quedó sana al instante.",
                                reference: "Marcos 5:25-34"
                            },
                            {
                                id: "3-09",
                                question: "¿Qué milagro realizó Jesús en el estanque de Betesda?",
                                options: ["Sana a un paralítico", "Alimenta a 5000", "Calma la tempestad", "Convierte agua en vino"],
                                answerIndex: 0,
                                hint: "Jesús le dijo a este hombre: 'Levántate, toma tu lecho y anda'.",
                                reference: "Juan 5:1-9"
                            },
                            {
                                id: "3-10",
                                question: "¿Qué hizo Jesús después de multiplicar los panes y los peces?",
                                options: ["Caminó sobre el agua", "Subió a un monte a orar", "Sanó a diez leprosos", "Contó la parábola del sembrador"],
                                answerIndex: 0,
                                hint: "Los discípulos estaban en una barca cuando vieron a Jesús acercándose.",
                                reference: "Mateo 14:22-33"
                            }
                        ]
                    },
                    {
                        level: 4,
                        title: "Nivel 4 — Parábolas de Jesús",
                        questions: [
                            {
                                id: "4-01",
                                question: "¿Qué parábola habla de un hijo que se fue de casa y despilfarró su herencia?",
                                options: ["El hijo pródigo", "El buen samaritano", "El sembrador", "Las diez vírgenes"],
                                answerIndex: 0,
                                hint: "El padre celebró con una fiesta cuando su hijo regresó arrepentido.",
                                reference: "Lucas 15:11-32"
                            },
                            {
                                id: "4-02",
                                question: "¿Qué parábola habla de un hombre que ayudó a un herido en el camino?",
                                options: ["El buen samaritano", "El hijo pródigo", "El fariseo y el publicano", "La oveja perdida"],
                                answerIndex: 0,
                                hint: "Sacerdotes importantes pasaron de largo, pero este hombre se detuvo a ayudar.",
                                reference: "Lucas 10:25-37"
                            },
                            {
                                id: "4-03",
                                question: "¿Qué parábola habla de semillas que caen en diferentes tipos de terreno?",
                                options: ["El sembrador", "La semilla de mostaza", "El trigo y la cizaña", "Los talentos"],
                                answerIndex: 0,
                                hint: "Algunas semillas cayeron en camino pedregoso, entre espinos y en buena tierra.",
                                reference: "Mateo 13:1-23"
                            },
                            {
                                id: "4-04",
                                question: "¿Qué parábola habla de diez jóvenes que esperaban al novio?",
                                options: ["Las diez vírgenes", "Los talentos", "La gran cena", "El mayordomo infiel"],
                                answerIndex: 0,
                                hint: "Cinco eran prudentes y llevaban aceite extra, cinco eran insensatas.",
                                reference: "Mateo 25:1-13"
                            },
                            {
                                id: "4-05",
                                question: "¿Qué parábola habla de un hombre que enterró el dinero que recibió?",
                                options: ["Los talentos", "Las diez vírgenes", "El hijo pródigo", "La perla de gran precio"],
                                answerIndex: 0,
                                hint: "Los otros siervos negociaron con el dinero y ganaron más.",
                                reference: "Mateo 25:14-30"
                            },
                            {
                                id: "4-06",
                                question: "¿Qué parábola habla de un pastor que busca una oveja perdida?",
                                options: ["La oveja perdida", "El buen samaritano", "El hijo pródigo", "La moneda perdida"],
                                answerIndex: 0,
                                hint: "El pastor deja las 99 ovejas para buscar la que se perdió.",
                                reference: "Lucas 15:3-7"
                            },
                            {
                                id: "4-07",
                                question: "¿Qué parábola habla de un hombre que encuentra un tesoro escondido?",
                                options: ["El tesoro escondido", "La perla de gran precio", "Los talentos", "El sembrador"],
                                answerIndex: 0,
                                hint: "El hombre vende todo lo que tiene para comprar el campo donde está el tesoro.",
                                reference: "Mateo 13:44"
                            },
                            {
                                id: "4-08",
                                question: "¿Qué parábola habla de un hombre que siembra buena semilla y su enemigo siembra mala hierba?",
                                options: ["El trigo y la cizaña", "El sembrador", "La semilla de mostaza", "Los labradores malvados"],
                                answerIndex: 0,
                                hint: "Jesús explica que al final de los tiempos los ángeles separarán lo bueno de lo malo.",
                                reference: "Mateo 13:24-30"
                            },
                            {
                                id: "4-09",
                                question: "¿Qué parábola habla de un fariseo y un recaudador de impuestos que oraban en el templo?",
                                options: ["El fariseo y el publicano", "El buen samaritano", "Los dos hijos", "La oveja perdida"],
                                answerIndex: 0,
                                hint: "El recaudador de impuestos se consideraba pecador, mientras que el fariseo se creía justo.",
                                reference: "Lucas 18:9-14"
                            },
                            {
                                id: "4-10",
                                question: "¿Qué parábola habla de una pequeña semilla que se convierte en un gran árbol?",
                                options: ["La semilla de mostaza", "El sembrador", "El trigo y la cizaña", "Los talentos"],
                                answerIndex: 0,
                                hint: "Jesús comparó esta semilla con el reino de los cielos.",
                                reference: "Mateo 13:31-32"
                            }
                        ]
                    },
                    // Niveles 5-20 continuarían aquí con 10 preguntas cada uno
                    // Para ahorrar espacio, solo se muestran los primeros 4 niveles
                    // En la implementación completa habría 20 niveles con 200 preguntas
                ];
                
                // Mezclar opciones en todas las preguntas
                gameData.levels.forEach(level => {
                    level.questions.forEach(question => {
                        // Guardar la respuesta correcta
                        const correctAnswer = question.options[question.answerIndex];
                        
                        // Mezclar las opciones
                        for (let i = question.options.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [question.options[i], question.options[j]] = [question.options[j], question.options[i]];
                        }
                        
                        // Encontrar el nuevo índice de la respuesta correcta
                        question.answerIndex = question.options.indexOf(correctAnswer);
                    });
                });
                
                // Inicializar progreso si no existe
                if (!localStorage.getItem('bibleQuizProgress')) {
                    initializeProgress();
                } else {
                    loadProgress();
                }
            } catch (error) {
                console.error('Error cargando preguntas:', error);
                initializeProgress();
            }
        }

        // Inicializar el progreso del juego
        function initializeProgress() {
            gameData.progress = {
                playerName: '',
                levels: {},
                currentLevel: 1
            };
            
            // Inicializar todos los niveles
            gameData.levels.forEach(level => {
                gameData.progress.levels[level.level] = {
                    unlocked: level.level === 1,
                    stars: 0,
                    completed: false,
                    questions: {}
                };
            });
            
            saveProgress();
        }

        // Cargar progreso desde localStorage
        function loadProgress() {
            const savedProgress = localStorage.getItem('bibleQuizProgress');
            if (savedProgress) {
                gameData.progress = JSON.parse(savedProgress);
                
                // Actualizar nombre si existe
                if (gameData.progress.playerName) {
                    document.getElementById('player-name').value = gameData.progress.playerName;
                    updateWelcomeMessage(gameData.progress.playerName);
                }
            }
        }

        // Guardar progreso en localStorage
        function saveProgress() {
            localStorage.setItem('bibleQuizProgress', JSON.stringify(gameData.progress));
        }

        // Actualizar mensaje de bienvenida
        function updateWelcomeMessage(name) {
            const messageElement = document.getElementById('personalized-message');
            messageElement.textContent = `¡Hola ${name}! 🙌 Dios te ama y está contento de que quieras aprender Sus historias. ¡Vamos a jugar y aprender juntos! 📖✨`;
        }

        // Mostrar pantalla
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        // Iniciar juego
        function startGame() {
            const playerName = document.getElementById('player-name').value.trim();
            if (!playerName) {
                alert('Por favor, escribe tu nombre para comenzar.');
                return;
            }
            
            gameData.progress.playerName = playerName;
            saveProgress();
            
            gameData.currentLevel = gameData.progress.currentLevel;
            gameData.currentQuestion = 0;
            gameData.score = 0;
            
            loadLevel(gameData.currentLevel);
        }

        // Cargar nivel
        function loadLevel(levelNumber) {
            const level = gameData.levels.find(l => l.level === levelNumber);
            if (!level) return;
            
            gameData.currentLevel = levelNumber;
            gameData.currentQuestion = 0;
            gameData.score = 0;
            
            document.getElementById('current-level-text').textContent = level.title;
            updateProgressBar();
            
            showQuestion();
            showScreen('game-screen');
        }

        // Mostrar pregunta actual
        function showQuestion() {
            const level = gameData.levels.find(l => l.level === gameData.currentLevel);
            if (!level || gameData.currentQuestion >= level.questions.length) {
                completeLevel();
                return;
            }
            
            const question = level.questions[gameData.currentQuestion];
            
            document.getElementById('question-text').textContent = question.question;
            document.getElementById('hint-text').textContent = question.hint;
            document.getElementById('reference-text').textContent = question.reference;
            
            // Leer pregunta en voz alta si está activado
            if (document.getElementById('voice-enabled').checked && 'speechSynthesis' in window) {
                const speech = new SpeechSynthesisUtterance(question.question);
                speech.lang = 'es-ES';
                speech.rate = 0.9;
                window.speechSynthesis.speak(speech);
            }
            
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-btn';
                button.textContent = option;
                button.addEventListener('click', () => checkAnswer(index));
                optionsContainer.appendChild(button);
            });
            
            document.getElementById('progress-text').textContent = `Pregunta ${gameData.currentQuestion + 1} de ${level.questions.length}`;
            document.getElementById('next-question-btn').disabled = true;
            document.getElementById('hint-container').classList.remove('show');
            document.getElementById('show-hint-btn').disabled = false;
            
            updateProgressBar();
        }

        // Comprobar respuesta
        function checkAnswer(selectedIndex) {
            const level = gameData.levels.find(l => l.level === gameData.currentLevel);
            const question = level.questions[gameData.currentQuestion];
            const options = document.querySelectorAll('.option-btn');
            
            // Deshabilitar todos los botones
            options.forEach(btn => {
                btn.disabled = true;
            });
            
            // Marcar respuesta correcta e incorrecta
            if (selectedIndex === question.answerIndex) {
                options[selectedIndex].classList.add('correct');
                gameData.score++;
                
                // Reproducir sonido de acierto
                playSound(sounds.correct);
                
                // Vibrar en dispositivos móviles
                if ('vibrate' in navigator) {
                    navigator.vibrate(200);
                }
                
                // Mostrar mensaje de ánimo
                showEncouragement(true);
            } else {
                options[selectedIndex].classList.add('incorrect');
                options[question.answerIndex].classList.add('correct');
                
                // Reproducir sonido de error
                playSound(sounds.incorrect);
                
                // Vibrar en dispositivos móviles
                if ('vibrate' in navigator) {
                    navigator.vibrate([100, 50, 100]);
                }
                
                // Mostrar mensaje de ánimo
                showEncouragement(false);
            }
            
            // Guardar respuesta en el progreso
            if (!gameData.progress.levels[gameData.currentLevel].questions) {
                gameData.progress.levels[gameData.currentLevel].questions = {};
            }
            
            gameData.progress.levels[gameData.currentLevel].questions[question.id] = 
                selectedIndex === question.answerIndex;
            
            saveProgress();
            
            document.getElementById('next-question-btn').disabled = false;
            document.getElementById('show-hint-btn').disabled = true;
        }

        // Mostrar mensaje de ánimo
        function showEncouragement(isCorrect) {
            const messages = {
                correct: [
                    "¡Correcto! Dios te bendice.",
                    "¡Muy bien! Sigues aprendiendo la Palabra de Dios.",
                    "¡Excelente! La Biblia tiene muchas historias maravillosas.",
                    "¡Así se hace! Jesús está contento contigo."
                ],
                incorrect: [
                    "¡Casi! Recuerda: \"Porque de tal manera amó Dios al mundo...\" Juan 3:16",
                    "No te rindas. \"Todo lo puedo en Cristo que me fortalece.\" Filipenses 4:13",
                    "Sigue intentando. \"El que persevera alcanza.\" Proverbios 28:20",
                    "Sigue aprendiendo. \"Tu palabra es una lámpara a mis pies.\" Salmo 119:105"
            ]
            };
            
            const randomIndex = Math.floor(Math.random() * messages[isCorrect ? 'correct' : 'incorrect'].length);
            alert(messages[isCorrect ? 'correct' : 'incorrect'][randomIndex]);
        }

        // Mostrar pista
        function showHint() {
            document.getElementById('hint-container').classList.add('show');
            document.getElementById('show-hint-btn').disabled = true;
            playSound(sounds.help);
        }

        // Siguiente pregunta
        function nextQuestion() {
            gameData.currentQuestion++;
            
            const level = gameData.levels.find(l => l.level === gameData.currentLevel);
            if (gameData.currentQuestion >= level.questions.length) {
                completeLevel();
            } else {
                showQuestion();
            }
        }

        // Completar nivel
        function completeLevel() {
            const level = gameData.levels.find(l => l.level === gameData.currentLevel);
            const totalQuestions = level.questions.length;
            const percentage = (gameData.score / totalQuestions) * 100;
            
            // Calcular estrellas
            let stars = 0;
            if (percentage >= 90) stars = 3;
            else if (percentage >= 70) stars = 2;
            else if (percentage >= 50) stars = 1;
            
            // Actualizar progreso
            gameData.progress.levels[gameData.currentLevel].completed = true;
            gameData.progress.levels[gameData.currentLevel].stars = stars;
            
            // Desbloquear siguiente nivel si existe
            if (gameData.currentLevel < gameData.levels.length) {
                const nextLevel = gameData.currentLevel + 1;
                if (gameData.progress.levels[nextLevel]) {
                    gameData.progress.levels[nextLevel].unlocked = true;
                }
                gameData.progress.currentLevel = nextLevel;
            }
            
            saveProgress();
            
            // Mostrar resultados
            document.getElementById('correct-answers').textContent = gameData.score;
            document.getElementById('stars-earned').textContent = stars;
            
            document.getElementById('results-title').textContent = `¡${level.title} Completado!`;
            document.getElementById('results-message').textContent = 
                `Has respondido correctamente ${gameData.score} de ${totalQuestions} preguntas.`;
            
            // Reproducir sonido de victoria
            playSound(sounds.celebrate);
            playSound(sounds.applause);
            
            // Mostrar confeti si las animaciones están activadas
            if (document.getElementById('animations-enabled').checked) {
                showConfetti();
            }
            
            showScreen('results-screen');
        }

        // Mostrar confeti
        function showConfetti() {
            const confetti = document.getElementById('confetti');
            confetti.classList.add('active');
            
            setTimeout(() => {
                confetti.classList.remove('active');
            }, 3000);
        }

        // Actualizar barra de progreso
        function updateProgressBar() {
            const level = gameData.levels.find(l => l.level === gameData.currentLevel);
            if (!level) return;
            
            const percentage = (gameData.currentQuestion / level.questions.length) * 100;
            document.getElementById('level-progress').style.width = `${percentage}%`;
        }

        // Cargar mapa de niveles
        function loadLevelMap() {
            const container = document.getElementById('level-map-container');
            container.innerHTML = '';
            
            gameData.levels.forEach(level => {
                const levelItem = document.createElement('div');
                levelItem.className = 'level-item';
                
                if (!gameData.progress.levels[level.level].unlocked) {
                    levelItem.classList.add('locked');
                } else {
                    levelItem.addEventListener('click', () => {
                        loadLevel(level.level);
                    });
                }
                
                levelItem.innerHTML = `
                    <h3>Nivel ${level.level}</h3>
                    <p>${level.title}</p>
                    <div class="level-stars">
                        ${'★'.repeat(gameData.progress.levels[level.level].stars)}${'☆'.repeat(3 - gameData.progress.levels[level.level].stars)}
                    </div>
                `;
                
                container.appendChild(levelItem);
            });
        }

        // Reiniciar progreso
        function resetProgress() {
            if (confirm('¿Estás seguro de que quieres borrar todo tu progreso? Esto no se puede deshacer.')) {
                initializeProgress();
                loadLevelMap();
                alert('Progreso reiniciado. ¡Vuelve a comenzar tu aventura bíblica!');
            }
        }

        // Cambiar tema
        function changeTheme(theme) {
            document.body.classList.remove('theme-dark', 'theme-party');
            
            if (theme === 'dark') {
                document.body.classList.add('theme-dark');
            } else if (theme === 'party') {
                document.body.classList.add('theme-party');
            }
        }

        // Inicializar juego
        async function initGame() {
            await loadQuestions();
            loadLevelMap();
            
            // Event listeners
            document.getElementById('start-btn').addEventListener('click', startGame);
            document.getElementById('view-levels-btn').addEventListener('click', () => {
                loadLevelMap();
                showScreen('levels-screen');
            });
            document.getElementById('reset-progress-btn').addEventListener('click', resetProgress);
            document.getElementById('back-from-levels').addEventListener('click', () => showScreen('welcome-screen'));
            document.getElementById('show-hint-btn').addEventListener('click', showHint);
            document.getElementById('next-question-btn').addEventListener('click', nextQuestion);
            document.getElementById('back-to-levels').addEventListener('click', () => showScreen('levels-screen'));
            document.getElementById('play-again-btn').addEventListener('click', () => loadLevel(gameData.currentLevel));
            document.getElementById('next-level-btn').addEventListener('click', () => {
                if (gameData.currentLevel < gameData.levels.length) {
                    loadLevel(gameData.currentLevel + 1);
                } else {
                    alert('¡Felicidades! Has completado todos los niveles.');
                    showScreen('levels-screen');
                }
            });
            document.getElementById('back-to-levels-from-results').addEventListener('click', () => {
                showScreen('levels-screen');
            });
            
            document.getElementById('player-name').addEventListener('input', (e) => {
                updateWelcomeMessage(e.target.value || 'amigo/a');
            });
            
            document.getElementById('theme-selector').addEventListener('change', (e) => {
                changeTheme(e.target.value);
            });
            
            document.getElementById('sound-enabled').addEventListener('change', (e) => {
                // No es necesario hacer nada aquí ya que los sonidos se controlan con playSound()
            });
            
            // Cargar tema guardado si existe
            const savedTheme = localStorage.getItem('bibleQuizTheme');
            if (savedTheme) {
                document.getElementById('theme-selector').value = savedTheme;
                changeTheme(savedTheme);
            }
            
            // Guardar preferencias de tema
            document.getElementById('theme-selector').addEventListener('change', (e) => {
                localStorage.setItem('bibleQuizTheme', e.target.value);
            });
            
            // Reproducir sonido de clic en botones
            document.querySelectorAll('button').forEach(button => {
                button.addEventListener('click', () => {
                    playSound(sounds.click);
                });
            });
        }

        // Iniciar cuando el documento esté listo
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
